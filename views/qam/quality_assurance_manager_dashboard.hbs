<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.6.0/Chart.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <style>
        .fakeimg {
            height: 35px;
            background: #aaa;
        }
    </style>
    <title>Quality Assurance Manager</title>
</head>
<body>
    {{> qamHeader}}
    
    <div class="container" style="margin-top:30px">
        <canvas id="myChart"></canvas>
    </div>
    <br><br>
    
    <div class="jumbotron text-center" style="margin-bottom:0">
        <p>Footer</p>
    </div>
</body>

    <script>

        const yAxesIT = [];
            const yAxesBu = [];
            const yAxesDes = [];
            const xAxes = [];
        drawChart();
      
        async function drawChart(){
            await getData();
            const ctx = document.getElementById("myChart").getContext("2d");
            const data = {
                labels: xAxes,
                datasets: [
                    {
                        label: "IT",
                        backgroundColor: "blue",
                        data: yAxesIT
                    },
                    {
                        label: "Business",
                        backgroundColor: "red",
                        data: yAxesBu
                    },
                    {
                        label: "Design",
                        backgroundColor: "green",
                        data: yAxesDes
                    }
                ]
            };
            const myBarChart = new Chart(ctx, {
                type: 'bar',
                data: data,
                options: {
                    barValueSpacing: 20,
                    scales: {
                        x: {
                            stacked: true,
                        },
                        y: {
                            stacked: true
                        }
                    }
                }
            });
        }

        async function getData(){
            const res = await fetch('../csv/dashboardData.csv');
            const data = await res.text();

            const table = data.split('\n').slice(1);
            table.forEach(row=>{
                const column = row.split(',')

                const year = column[3]
                xAxes.push(year)
                
                const IT = column[0]
                yAxesIT.push(IT)

                const Business = column[1]
                yAxesBu.push(Business)

                const Design = column[2]
                yAxesDes.push(Design)
            })
            

        }


        
      </script>
    </script>
</html>